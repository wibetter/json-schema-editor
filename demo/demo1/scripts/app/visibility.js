window.visibility=function(){"use strict";var i,e=-1,t={onVisible:function(i){var e=t.isSupported();if(!e||!t.hidden())return i(),e;var n=t.change((function(e,r){t.hidden()||(t.unbind(n),i())}));return n},change:function(i){if(!t.isSupported())return!1;var n=e+=1;return t._callbacks[n]=i,t._listen(),n},unbind:function(i){delete t._callbacks[i]},afterPrerendering:function(i){var e=t.isSupported(),n="prerender";if(!e||n!=t.state())return i(),e;var r=t.change((function(e,d){n!=d&&(t.unbind(r),i())}));return r},hidden:function(){return!(!t._doc.hidden&&!t._doc.webkitHidden)},state:function(){return t._doc.visibilityState||t._doc.webkitVisibilityState||"visible"},isSupported:function(){return!(!t._doc.visibilityState&&!t._doc.webkitVisibilityState)},_doc:document||{},_callbacks:{},_change:function(i){var e=t.state();for(var n in t._callbacks)t._callbacks[n].call(t._doc,i,e)},_listen:function(){if(!t._init){var i="visibilitychange";t._doc.webkitVisibilityState&&(i="webkit"+i);var e=function(){t._change.apply(t,arguments)};t._doc.addEventListener?t._doc.addEventListener(i,e):t._doc.attachEvent(i,e),t._init=!0}}},n=-1;return(i=t).every=function(e,t,r){i._time(),r||(r=t,t=null);var d=n+=1;return i._timers[d]={visible:e,hidden:t,callback:r},i._run(d,!1),i.isSupported()&&i._listen(),d},i.stop=function(e){return!!i._timers[e]&&(i._stop(e),delete i._timers[e],!0)},i._timers={},i._time=function(){i._timed||(i._timed=!0,i._wasHidden=i.hidden(),i.change((function(){i._stopRun(),i._wasHidden=i.hidden()})))},i._run=function(e,t){var n,r=i._timers[e];if(i.hidden()){if(null===r.hidden)return;n=r.hidden}else n=r.visible;var d=function(){r.last=new Date,r.callback.call(window)};if(t){var a=new Date-r.last;n>a?r.delay=setTimeout((function(){r.id=setInterval(d,n),d()}),n-a):(r.id=setInterval(d,n),d())}else r.id=setInterval(d,n)},i._stop=function(e){var t=i._timers[e];clearInterval(t.id),clearTimeout(t.delay),delete t.id,delete t.delay},i._stopRun=function(e){var t=i.hidden(),n=i._wasHidden;if(t&&!n||!t&&n)for(var r in i._timers)i._stop(r),i._run(r,!t)},t}();